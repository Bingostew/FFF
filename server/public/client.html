<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Find, Fix, & Finish - Server Tester</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #00ff00; padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .panel { border: 1px solid #333; padding: 15px; border-radius: 5px; }
        .log { background: #000; height: 200px; overflow-y: scroll; padding: 10px; border: 1px solid #00ff00; font-size: 12px; margin-top: 10px; }
        button { background: #00ff00; color: #000; border: none; padding: 8px 15px; cursor: pointer; font-weight: bold; margin: 5px 0; }
        input { background: #333; color: #fff; border: 1px solid #555; padding: 5px; }
        .status { color: yellow; }
    </style>
</head>
<body>

    <h1>âš“ FFF Server Debugger</h1>
    
    <div class="grid">
        <div class="panel">
            <h3>1. Connection & Lobby</h3>
            <button onclick="createLobby()">Create New Lobby (HTTP)</button>
            <br>
            <input type="text" id="roomIdInput" placeholder="Enter Room ID">
            <input type="text" id="nameInput" placeholder="Name">
            <button onclick="joinGame()">Join Room (Socket)</button>
            <p>Status: <span id="connStatus" class="status">Disconnected</span></p>
        </div>

        <div class="panel">
            <h3>2. Game Actions</h3>
            <button onclick="placeFleets()">Place Fleets (0,0 & 1,1)</button>
            <br>
            <input type="number" id="targetQ" placeholder="Q" style="width:40px">
            <input type="number" id="targetR" placeholder="R" style="width:40px">
            <button onclick="executeStrike()">Execute Strike</button>
        </div>
    </div>

    <h3>ðŸ“œ Event Log</h3>
    <div id="eventLog" class="log"></div>

    <script>
        const socket = io();
        let currentRoom = '';

        // --- Logging ---
        function log(msg, obj = '') {
            const logDiv = document.getElementById('eventLog');
            logDiv.innerHTML += `<div>[${new Date().toLocaleTimeString()}] ${msg} ${obj ? JSON.stringify(obj) : ''}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // --- HTTP Actions ---
        async function createLobby() {
            const res = await fetch('/create-lobby', { method: 'POST' });
            const data = await res.json();
            document.getElementById('roomIdInput').value = data.gameId;
            log("Lobby Created:", data);
        }

        // --- Socket Actions ---
        function joinGame() {
            const gameId = document.getElementById('roomIdInput').value;
            const playerName = document.getElementById('nameInput').value || 'Tester';
            currentRoom = gameId;
            socket.emit('join_game', { gameId, playerName });
            document.getElementById('connStatus').innerText = `Connected to ${gameId}`;
        }

        function placeFleets() {
            const fleetPositions = {
                alpha: { q: 0, r: 0 }, // Example positions it will change in the future when the hexes are selectable
                beta: { q: 1, r: 1 } // Example positions it will change in the future when the hexes are selectable
            };
            socket.emit('place_fleets', { gameId: currentRoom, fleetPositions });
            log("Fleets sent to server.");
        }

        function executeStrike() {
            const q = parseInt(document.getElementById('targetQ').value);
            const r = parseInt(document.getElementById('targetR').value);
            socket.emit('execute_strike', { gameId: currentRoom, targetHex: { q, r } });
            log(`Striking hex: ${q},${r}`);
        }

        // function move_fleet(fleetName, newPosition) {
            
        //     log(`Moving fleet ${fleetName} to ${newPosition}`);

        //     socket.emit('move_fleet', { gameId: currentRoom, fleetName, newPosition });
        // }

        // --- Listeners ---
        socket.on('room_update', (data) => log("Room Update:", data));
        socket.on('opponent_ready', () => log("Alert: Opponent has placed ships!"));
        socket.on('game_start', (data) => log("GAME START! Active Player:", data));
        socket.on('strike_result', (data) => {
            const color = data.hit ? 'red' : 'green';
            if(data.isdestroyed){
                log(`<span style="color:${orange}">ðŸ’¥ FLEET DESTROYED!</span>`, data);
            }else{
                log(`<span style="color:${color}">${data.hit ? 'ðŸ’¥ HIT!' : 'ðŸŒŠ MISS!'}</span>`, data);
            }
            
        });
        socket.on('game_over', (data) => log("GAME OVER!", data));
        socket.on('move_fleet', (data) => log("Fleet Moved:", data));
        socket.on('error', (msg) => log("ERROR:", msg));
    </script>
</body>
</html>